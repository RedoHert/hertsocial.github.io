<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Hert Social</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

   
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            color: #ecf0f1;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            color: #ffffff;
        }

        #registerForm,
        #loginForm,
        #socialContent {
            max-width: 600px;
            margin: 20px auto;
            background-color: #34495e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #df95ff;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        input[type="file"] {
            width: calc(100% - 10px);
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #7f8c8d;
            border-radius: 4px;
            background-color: #2c3e50;
            color: #ecf0f1;
        }

        button {
            padding: 8px 15px;
            background-color: #9b59b6;
            color: #ecf0f1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #8e44ad;
        }

        #posts {
            margin-top: 20px;
        }

        .post-container {
            background-color: #34495e;
            border: 1px solid #7f8c8d;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .post-container img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }

        .post-container p {
            margin: 0;
            color: #ecf0f1;
        }

        .post-container button {
            padding: 5px 10px;
            background-color: #e74c3c;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }

        .post-container button:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <h1>Hert Social 游깷</h1>
    
    <div id="registerForm" style="display: none;">
        <h2>Criar Nova Conta</h2>
        <label for="newUsername">Usu치rio:</label>
        <input type="text" id="newUsername">
        <label for="newPassword">Senha (M칤nimo 6 letras):</label>
        <input type="password" id="newPassword">
        <button onclick="register()">Registrar</button>
        <p>J치 tem uma conta? <a href="#" onclick="showLoginForm()">Fa칞a login</a></p>
        <div id="registerError" style="display: none; color: red;"></div>
    </div>

    <div id="loginForm">
        <h2>Login</h2>
        <label for="usernameInput">Usu치rio:</label>
        <input type="text" id="usernameInput">
        <label for="passwordInput">Senha:</label>
        <input type="password" id="passwordInput">
        <button onclick="login()">Login</button>
        <p>N칚o tem uma conta? <a href="#" onclick="showRegisterForm()">Registre-se</a></p>
        <div id="loginError" style="display: none; color: red;"></div>
    </div>
    
    <div id="socialContent" style="display: none;">
        <div>
            <label for="loggedInUser">Username:</label>
            <span id="loggedInUser"></span>
        </div>
        <div>
            <label for="userProfilePic">Foto de perfil:</label>
            <input type="file" accept="image/*" id="userProfilePicInput">
            <button onclick="uploadProfilePic()">Upload</button>
            <img id="userProfilePic" alt="Foto de perfil" style="width: 50px; height: 50px; border-radius: 50%;">
        </div>
        <textarea id="postContent" placeholder="Digite seu post"></textarea>
        <button onclick="criarPost()">Criar Post</button>
        <button onclick="logout()" style="background-color: red; color: white;">Logout</button>
            
        <div id="posts"></div>
    </div>

    <script>
     const firebaseConfig = {
        apiKey: "AIzaSyBuxQ5I2eYLq0VtYSItTv-I4C4wMQpGx3g",
        authDomain: "hertsocial-8d76f.firebaseapp.com",
        databaseURL: "https://hertsocial-8d76f-default-rtdb.firebaseio.com",
        projectId: "hertsocial-8d76f",
        storageBucket: "hertsocial-8d76f.appspot.com",
        messagingSenderId: "211037763102",
        appId: "1:211037763102:web:e2163a705f3b03b728200f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
        function isAuthenticated() {
            var storedUsername = localStorage.getItem('username');
            var loggedInUser = document.getElementById('loggedInUser').textContent;
    
            return storedUsername === loggedInUser;
        }
    
        function uploadProfilePic() {
            if (isAuthenticated()) {
                var fileInput = document.getElementById('userProfilePicInput');
                var file = fileInput.files[0];
                
                var reader = new FileReader();
                reader.onload = function(event) {
                    var imgBase64 = event.target.result;
                    document.getElementById('userProfilePic').src = imgBase64;
    
                    var loggedInUser = document.getElementById('loggedInUser').textContent;
                    localStorage.setItem('profilePic_' + loggedInUser, imgBase64);
                };
                
                reader.readAsDataURL(file);
            } else {
                alert('Voc칡 n칚o est치 autenticado para fazer isso.');
            }
        }
    
        function mostrarPosts() {
    var postsContainer = document.getElementById('posts');
    postsContainer.innerHTML = '';

    const db = firebase.database();
    const postsRef = db.ref('posts');

    postsRef.on('value', function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
            var post = childSnapshot.val();
            var postElement = document.createElement('div');
            postElement.className = 'post-container';
            postElement.innerHTML = '<div>' +
                '<img src="' + post.profilePic + '" alt="Foto de perfil">' +
                '<p><strong>' + post.username + '</strong> em ' + post.date + '<br>' + post.content;

            if (isAuthenticated() && post.username === document.getElementById('loggedInUser').textContent) {
                postElement.innerHTML += '<button onclick="deletarPost(\'' + childSnapshot.key + '\')">Excluir</button>';
            }

            postElement.innerHTML += '</p></div>';
            postsContainer.appendChild(postElement);
        });
    });
}

function criarPost() {
    var username = document.getElementById('loggedInUser').textContent;
    var profilePic = localStorage.getItem('profilePic_' + username) || '';
    var postContent = document.getElementById('postContent').value;

    if (postContent.trim() !== '') {
        var post = {
            username: username,
            profilePic: profilePic,
            content: postContent,
            date: new Date().toLocaleString()
        };

        // Salva o post no Firebase Realtime Database
        const db = firebase.database();
        const postsRef = db.ref('posts');
        postsRef.push(post);

        // Limpa o campo de texto ap칩s a cria칞칚o do post
        document.getElementById('postContent').value = '';

        // Mostra os posts atualizados
        mostrarPosts();
    } else {
        alert('Por favor, insira um conte칰do para o post.');
    }
}


        function logout() {
            localStorage.removeItem('username');
            document.getElementById('loggedInUser').textContent = '';
            showLoginForm();
        }

        function login() {
    var username = document.getElementById('usernameInput').value;
    var password = document.getElementById('passwordInput').value;

    // Adicionando um sufixo fict칤cio de e-mail
    var email = username + '@example.com';

    firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            console.log('Usu치rio logado com sucesso:', userCredential.user.uid);
            showSocialContent();
            document.getElementById('loggedInUser').textContent = username;
            mostrarPosts();
        })
        .catch((error) => {
            console.error('Erro ao fazer login:', error.message);
            document.getElementById('loginError').textContent = 'Usu치rio n칚o encontrado.';
            document.getElementById('loginError').style.display = 'block';
        });
}






function register() {
    var username = document.getElementById('newUsername').value;
    var password = document.getElementById('newPassword').value;

    if (password.length < 6) {
        document.getElementById('registerError').textContent = 'A senha deve ter pelo menos 6 letras.';
        document.getElementById('registerError').style.display = 'block';
        return; // Impede que o registro prossiga
    }

    // Adicionando um sufixo fict칤cio de e-mail
    var email = username + '@example.com';

    firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            console.log('Usu치rio registrado com sucesso:', userCredential.user.uid);
            showLoginForm(); // Redireciona para o formul치rio de login ap칩s o registro
        })
        .catch((error) => {
            console.error('Erro ao registrar usu치rio:', error.message);
        });
}

       
          document.addEventListener('novosPosts', mostrarPosts);

        function showRegisterForm() {
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('socialContent').style.display = 'none';
        }

        function showLoginForm() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('socialContent').style.display = 'none';
        }

        function showSocialContent() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('socialContent').style.display = 'block';
        }

        function deletarPost(postKey) {
    if (isAuthenticated()) {
        const db = firebase.database();
        const postsRef = db.ref('posts');

        postsRef.child(postKey).remove()
            .then(function() {
                mostrarPosts();
            })
            .catch(function(error) {
                console.error('Erro ao excluir o post:', error);
            });
    } else {
        alert('Voc칡 n칚o est치 autenticado para fazer isso.');
    }
}

  
        function verificarNovosPosts() {
            setInterval(function() {
                var lastPosts = JSON.parse(localStorage.getItem('lastPosts')) || [];
                var currentPosts = JSON.parse(localStorage.getItem('posts')) || [];

                if (JSON.stringify(lastPosts) !== JSON.stringify(currentPosts)) {
                    document.dispatchEvent(new Event('novosPosts'));
                    localStorage.setItem('lastPosts', JSON.stringify(currentPosts));
                }
            }, 3000); 
        }

        verificarNovosPosts();
        mostrarPosts();
    </script>
</body>
</html>
